---
import { BackgroundPicture } from "astro-imagetools/components";
import fs from "fs";

const { path } = Astro.props;
const imageFiles =
  Astro.props.imageFiles ||
  fs.readdirSync(path).filter((file) => {
    if (!file.includes("portrait")) return /.png|.jpg|.jpeg/.test(file);
  });
---

<div class="w-full h-screen max-w-screen-2xl 2xl:mx-auto fixed top-0 -z-10">
  {
    imageFiles.map((imagefile, index) => {
      return (
        <BackgroundPicture
          src={`/${path}/${imagefile}`}
          tag="div"
          breakpoints={{ count: 8, minWidth: 320, maxWidth: 3840 }}
          loading="eager"
          sizes={(breakpoints) => {
            const maxWidth = breakpoints[breakpoints.length - 1];
            return `(min-width: ${maxWidth}px) ${maxWidth}px, 100vw`;
          }}
          attributes={{
            link: {
              fetchpriority: "high",
            },
          }}
          artDirectives={[
            {
              src: `/${path}/${imagefile.replace(".", "_portrait.")}`,
              media: "(max-aspect-ratio: 2/3)",
              breakpoints: { count: 6, minWidth: 300, maxWidth: 1400 },
            },
          ]}
        >
          <div class="h-full pt-20 pb-12 bg-white-900/50">
            <div class="container mx-auto flex flex-col justify-end h-screen" />
          </div>
        </BackgroundPicture>
      );
    })
  }
</div>
