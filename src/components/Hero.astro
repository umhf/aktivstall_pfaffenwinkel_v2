---
import { BackgroundPicture } from "astro-imagetools/components";
import fs from "fs";

const { path, heading } = Astro.props;
const imageFiles =
  Astro.props.imageFiles ||
  fs.readdirSync(path).filter((file) => {
    if (!file.includes("portrait")) return /.png|.jpg|.jpeg/.test(file);
  });
---

<div class="-mx-4 w-full max-w-screen-2xl 2xl:mx-auto fixed top-0 -z-10">
  {
    imageFiles.map((imagefile, index) => {
      return (
        <BackgroundPicture
          src={`/${path}/${imagefile}`}
          tag="div"
          breakpoints={{ count: 8, minWidth: 320, maxWidth: 3840 }}
          loading="eager"
          sizes={(breakpoints) => {
            const maxWidth = breakpoints[breakpoints.length - 1];
            return `(min-width: ${maxWidth}px) ${maxWidth}px, 100vw`;
          }}
          attributes={{
            link: {
              fetchpriority: "high",
            },
          }}
          artDirectives={[
            {
              src: `/${path}/${imagefile.replace(".", "_portrait.")}`,
              media: "(max-aspect-ratio: 2/3)",
              breakpoints: { count: 6, minWidth: 300, maxWidth: 1400 },
            },
          ]}
        >
          <div class="h-full pt-20 pb-12 px-4 bg-white-900/50">
            <div class="container mx-auto flex flex-col justify-end h-96 min-h-[70vh]" />
          </div>
        </BackgroundPicture>
      );
    })
  }
</div>
<div class="bottom-8 z-10 w-full mt-40">
  <div class="mx-auto container text-center">
    <h2 class="text-base text-xl lg:text-2xl text-white-50 font-text m-0">
      <span class="font-sec text-colored-300">Aktivstall</span> Pfaffenwinkel
    </h2>
    <h1 class="text-5xl leading-none lg:text-7xl leading-tight text-white-50 mt-0 shadow-white">
      {heading}
    </h1>
  </div>
</div>

<script>
  const images = document.querySelectorAll(".bg-image");
  if (images.length > 1) {
    let max = images.length,
      index = 0;

    function change() {
      let next = index === max - 1 ? 0 : index + 1;
      images[index].classList.toggle("opacity-0");
      images[next].classList.toggle("opacity-0");
      index = next;
    }
    setInterval(change, 5000);
  }
</script>
